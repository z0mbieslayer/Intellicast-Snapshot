(function(b){if(!window.Backbone){return}if(!wui.citypage){wui.citypage={Views:{},Models:{}}}var a=wui.backbone.utils;var c=wui.backbone.configs;wui.citypage.AppView=Backbone.View.extend({initialize:function(g){var j=this;this.options=g||{};this.models=this.options.models||{};this.models.weather=this.createWeatherModel();this.models.history=this.createHistoryModel();this.models.yesterday=this.createYesterdayHistoryModel();this.models.plotGroup=this.createPlotGroupModel();this.models.wundermap=this.createWundermapModel();this.models.precip=this.createPrecipModel();this.models.pollen=this.createPollenModel();this.models.alertsList=this.createAlertsListModel();this.models.weatherFiveDay=this.createWeatherFiveDayModel();this.collections={};this.collections.rapidfireStations=this.createRapidfireStationsCollection();this.collections.nearbyStations=this.createNearbyStationsCollection();this.views={};this.viewsWhenVisible=[];this.createViews();this.$el.on("click","a[data-reveal-id][data-wui-reveal-delegated]",this.onClickRevealButton);this.$el.on("click","a#LayerRadarAnimGif_radio, a#LayerSatellite_radio",this.onClickTabs);if(b("#LayerWebcams_checkbox").length){this.$el.on("change","#LayerWebcams_checkbox",this.onWebcamToggle)}b(document).ready(function(){if(wui&&wui.favorites&&wui.favorites.stars){wui.favorites.stars.initialize()}});this.listenTo(this.models.weather,"change",this.renderUpdatedTime);this.listenTo(this.models.weather,"rapidfire",this.renderUpdatedTime);this.collections.rapidfireStations.add(this.models.weather);this.collections.rapidfireStations.rapidfireSetOptions({units:this.models.weather.get("response.units")});this.collections.rapidfireStations.rapidfireStart();var f=500;var i=_.bind(this.onScroll,this);var h=_.throttle(i,f);b(window).on("scroll",h);this.initializeViewsWhenVisible();var e=[];_.each(this.views,function(k){if(k.viewLoaded){e.push(k.viewLoaded)}});if(wui.usher.loadAds){var d=this;b.when.apply(b,e).done(function(){wui.usher.loadAds()})}b("#station-select-button").show();b(document).on("click","#station-select-button",b.proxy(this.loadSM,this));this.setupMetrics();this.startInitialization()},loadSM:function(){if(!window.twc){var d=null;d=wui.usher.loadScript("angularStationselect")}else{angular.element("#station-select-button-ng").triggerHandler("click")}},startInitialization:function(){this.viewLoaded=b.Deferred();var f=this;var e=[];var d=null;d=wui.usher.loadScript("mosaicmap");e.push(d);b.when.apply(b,e).done(function(){f.continueInit()})},continueInit:function(){var d=this;var e=null;e=wui.usher.loadScript("mosaicwundermap");e.fail(function(h,f,g){console.log("mosaic wundermap failed")});e.done(function(h,f,g){d.finishInit()})},finishInit:function(){this.viewLoaded.resolve();this.rendermosaic()},rendermosaic:function(){this.lat=wui.bootstrapped.citypage.lat;this.lon=wui.bootstrapped.citypage.lon;var d={lat:this.lat,lon:this.lon,attribution:true,mapType:wui.bootstrapped.citypage.mosaic.map_type,animationOptions:{animationControl:true,animationControlPosition:"topLeft",start:false,stop:true,back:false,forward:false,play:true,end:false},zoomOptions:{scrollWheelZoom:true,zoomControl:true,zoomControlPosition:"bottomRight",zoomLevel:10,zoomByNumStations:false,minStations:15,maxStations:25,scrollToZoom:false,doubleClickToZoom:false},layers:[{datalayer:"Radar",opacity:0.7},{datalayer:"Satellite",opacity:0.8}]};if(b("#LayerWebcams_checkbox").length){d.layers.push({datalayer:"Webcams",opacity:0.8})}mosaicmap.loadMap(d);if(mosaicmap.map.initialized==true){this.setActiveTabLayer()}else{b(document).on("MosaicDone",this.setActiveTabLayer)}return this},setActiveTabLayer:function(){var e=wui.bootstrapped.prefs.RADARBOX;var d=wui.bootstrapped.prefs.RADARBOX_WEBCAM;if(e=="RADAR"||e==null||e==undefined){b("a#LayerRadarAnimGif_radio").parent("li").addClass("ui-state-active");b(".leaflet-Satellite-pane").hide();if(b("#wx-map-radar .no-radar").length){b("#wx-map-radar .no-radar").show()}}else{b("a#LayerSatellite_radio").parent("li").addClass("ui-state-active");b(".leaflet-Radar-pane").hide();if(b("#wx-map-radar .no-radar").length){b("#wx-map-radar .no-radar").hide()}}if(d==="WEBCAM"){b(".leaflet-Webcams-pane").show();b("#LayerWebcams_checkbox").prop("checked",true)}else{b(".leaflet-Webcams-pane").hide()}},createViews:function(){var e=this;this.views.locationView=new wui.Views.Location({model:this.model,models:{weather:this.models.weather},el:b("#location")[0]});this.views.currentView=new wui.Views.Current({model:this.model,models:{weather:this.models.weather},el:b("#current")[0]});this.views.precipView=new wui.citypage.Views.Precip({model:this.models.precip,weather:e.models.weather,el:b("#current")[0],active:["above","map"],render:false});this.views.pollenView=new wui.citypage.Views.Pollen({model:this.models.pollen,weather:e.models.weather,el:b("#current")[0],render:false});this.views.UVView=new wui.citypage.Views.UV({model:this.models.weatherFiveDay,weather:e.models.weather,el:b("#current")[0],render:false});this.views.AirQualityHookView=new wui.citypage.Views.AirQualityHook({weather:e.models.weather,el:b("#current")[0],render:false});this.views.VoteView=new wui.citypage.Views.Vote({model:e.models.weather,el:b("#current")[0],render:false});var d=b("#weather-map");if(d[0]){if(window.matchMedia("(min-width: 640px)").matches){d.appendTo("#ccMap").show()}if(wui.bootstrapped.prefs.RADARBOX_WEBCAM==="WEBCAM"){b(d[0].children[2]).prop("checked",true)}}this.views.forecastView=new wui.Views.Forecast({model:this.model,models:{plotGroup:this.models.plotGroup,precip:this.models.precip},render:false,tabindex:wui.storage.getLocal("cityForecastTab"),weather:this.models.weather,el:b("#forecast")[0]});this.initializeViewWhenVisible(this.views.forecastView);if(b("#station-list-table")[0]){this.views.stationListView=new wui.citypage.Views.StationList({model:this.model,collections:{nearbyStations:this.collections.nearbyStations},weather:this.models.weather,el:b("#station-list-table")[0]});this.initializeViewWhenVisible(this.views.stationListView)}if(b("#webcams")[0]){this.views.webcamsView=new wui.citypage.Views.Webcams({model:this.model,weather:this.models.weather,el:b("#webcams")[0]})}this.views.feedbackFormView=new wui.citypage.Views.FeedbackForm({el:b("#feedback")[0]});if(b("#community-content")[0]){this.views.communityView=new wui.citypage.Views.Community({model:this.model,models:{weather:this.models.weather},el:b("#community-content")[0]});this.initializeViewWhenVisible(this.views.communityView)}if(b("#almanac-content")[0]){this.views.almanacView=new wui.citypage.Views.Almanac({model:this.model,models:{weather:this.models.weather,history:this.models.history,yesterday:this.models.yesterday},el:b("#almanac-content")[0]});this.initializeViewWhenVisible(this.views.almanacView)}if(b("#nearby-content")[0]){this.views.nearbyView=new wui.citypage.Views.Nearby({model:this.model,models:{weather:this.models.weather,},el:b("#nearby-content")[0]});this.initializeViewWhenVisible(this.views.nearbyView)}if(b("#alerts-box")[0]){this.views.alertModule=new wui.Views.AlertModule({model:this.models.alertsList,type:b("#alerts-box").hasClass("alerts-box-severe")?"severe":"forecast",el:b("#alerts-box")[0]})}},initializeViewWhenVisible:function(d){this.viewsWhenVisible.push({initialized:false,view:d})},initializeViewsWhenVisible:function(){var d=b(window).height();var f=b(window).scrollTop();var e=f+d;_.each(this.viewsWhenVisible,function(h){if(!h.initialized){var g=h.view;var i=g.$el.offset();if(i.top<=e&&g.initializeLater){g.initializeLater();h.initialized=true}}})},onClickRevealButton:function(g){g.preventDefault();var f=b(this);var d=f.attr("data-reveal-id");b("#"+d).foundation("reveal","open")},onClickTabs:function(f){f.preventDefault();b("#wundermap_module_tabs li").removeClass("ui-state-active");b(f.target).parent("li").addClass("ui-state-active");var d=b(f.target).attr("data-type");if(d=="Radar"){b(".leaflet-Satellite-pane").hide();b(".leaflet-Radar-pane").show();wui.prefs.set("RADARBOX","RADAR");if(b("#wx-map-radar .no-radar").length){b("#wx-map-radar .no-radar").show()}}else{if(d=="Satellite"){b(".leaflet-Satellite-pane").show();b(".leaflet-Radar-pane").hide();wui.prefs.set("RADARBOX","SAT");if(b("#wx-map-radar .no-radar").length){b("#wx-map-radar .no-radar").hide()}}}},onWebcamToggle:function(d){d.preventDefault();if(b(this).is(":checked")){b(".leaflet-Webcams-pane").show();wui.prefs.set("RADARBOX_WEBCAM","WEBCAM")}else{b(".leaflet-Webcams-pane").hide();wui.prefs.set("RADARBOX_WEBCAM","")}},onScroll:function(d){this.initializeViewsWhenVisible()},render:function(){return this},renderUpdatedTime:function(){var e=this.models.weather.getUpdatedTimeAgo();var f=this.models.weather.isOffline();var d=this.$el.find("#update-time");d.html(e);d.removeClass("offline");if(f){d.addClass("offline")}},setupMetrics:function(){var d=["forecast_graph_zoom","forecast_tabs_activate","forecast_variables_menu_open","forecast_variables_menu_close"];this.listenTo(this.views.forecastView,"all",function(e){if(wui.arrayContains(e,d)){this.trigger.apply(this,arguments)}})},createPlotGroupModel:function(){return c.createPlotGroupModel({weather:this.models.weather})},createPrecipModel:function(){var e=wui.bootstrapped.prefs;var f=this.models.weather.get("current_observation.station.latitude")||wui.bootstrapped.citypage.lat;var g=this.models.weather.get("current_observation.station.longitude")||wui.bootstrapped.citypage.lon;var d=new wui.Models.Precip({},{apikey:"6532d6454b8aa370768e63d6ba5a832e",lang:e.BrowserCode||e.LangCode,units:e.Units,version:"v1",lat:f,lon:g,fetchStatement:true});return d},createPollenModel:function(){var e=this.models.weather.get("current_observation.station.latitude")||wui.bootstrapped.citypage.lat;var f=this.models.weather.get("current_observation.station.longitude")||wui.bootstrapped.citypage.lon;var d=new wui.Models.Pollen({},{apiKey:"6532d6454b8aa370768e63d6ba5a832e",lat:e,lon:f});return d},createAlertsListModel:function(){var d=new wui.Models.AlertsList();return d},createWeatherFiveDayModel:function(){var e=this.models.weather.get("current_observation.station.latitude")||wui.bootstrapped.citypage.lat;var f=this.models.weather.get("current_observation.station.longitude")||wui.bootstrapped.citypage.lon;var d=new wui.Models.WeatherFiveDay({},{apiKey:"6532d6454b8aa370768e63d6ba5a832e",lat:e,lon:f});return d},createWundermapModel:function(){var f=wui.bootstrapped.prefs;var e=null;if(wui.bootstrapped.citypage){e=wui.bootstrapped.citypage.storm?1:0}var g=e?5:8;var d=new wui.Models.Wundermap({lat:this.models.weather.get("current_observation.station.latitude"),lon:this.models.weather.get("current_observation.station.longitude"),country:this.models.weather.get("current_observation.station.country_name"),zoom:g,gMapType:f.GMAPTYPE,gMapUnits:f.GMAPUNITS});return d},createWeatherModel:function(){var e=wui.bootstrapped.prefs;var f=wui.bootstrapped.citypage.zmw;var g="";if(e.selected_pws!=""){g="pws:"+e.selected_pws}else{g="zmw:"+f}var d=new wui.Models.Weather(wui.api_data,{apikey:"d8585d80376a429e",bestfct:a.fromPrefToBoolean(e.EXPFCT,true),lang:e.LangCode,features:["forecast10day","hourly10day","astronomy10day","conditions"],selected_pws:wui.bootstrapped.prefs.selected_pws,query:g,fodqa:wui.bootstrapped.prefs.fodqa,units:e.Units,version:"2.0"});return d},createHistoryModel:function(){var n=wui.bootstrapped.prefs;var f={};var d=wui.bootstrapped.citypage.airports[0].code;var e=wui.api_data.current_observation.date;var k=wui.date.pad(e.month);var m=wui.date.pad(e.day);var j=wui.date.pad(e.day-1);var g=k+m;var i=k+j;var l="planner_"+g+g;var h=new wui.Models.Weather(f,{apikey:"d8585d80376a429e",lang:n.LangCode,query:d,features:["forecast","almanac",l],units:n.Units,version:""});return h},createYesterdayHistoryModel:function(){var l=wui.bootstrapped.prefs;var f={};var d=wui.bootstrapped.citypage.airports[0].code;var e=wui.api_data.current_observation.date;var j=wui.date.pad(e.year);var i=wui.date.pad(e.month);var h=wui.date.pad(e.day-1);var k="history_"+j+i+h;var g=new wui.Models.Weather(f,{apikey:"d8585d80376a429e",lang:l.LangCode,query:d,features:[k],units:l.Units,version:""});return g},createNearbyStationsCollection:function(){var d=this.models.weather.get("response.location");var e=new wui.Collections.Station([],{centerLat:d.latitude,centerLon:d.longitude,maxstations:60,requiredVariables:["temperature"],units:this.models.weather.get("response.units"),selectedStation:wui.bootstrapped.prefs.selected_pws});return e},createRapidfireStationsCollection:function(){var d=new wui.Collections.Weather();return d},updateLayer:function(d){if(d!==null){return d}else{var e=this.models.weather.get("current_observation.station.country_name");if(e&&this.checkCountryHasRadar(e)){return"RADAR"}else{return"SAT"}}},checkCountryHasRadar:function(e){var h=this.toTitleCase(e);var d=["Ireland","United Kingdom","France","Spain","Portugal","Belgium","Netherlands","Germany","Switzerland","Italy","Austria","Czech Republic","Poland","Denmark"];var f=["Usa","Canada","Australia"];var g=f.concat(d);return(b.inArray(h,g)!=-1)},toTitleCase:function(d){return d.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.AirQuality=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$aq_table=this.$el.find("#aq_table");this.listenTo(this.models.weather,"change:health_data",this.render)},render:function(){var e=this.models.weather.attributes.health_data.air_quality;if(e=={}){return}var b={obs:e};var d=this.$el.find("#aq_na");if(d){d.remove()}this.template=_.template(a("script#air-quality-template").html());var c=this.template(b);this.$aq_table.append(c);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.AlmanacHistory=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.weather=this.options.weather;this.models=this.options.models||{};if(this.options.render){this.initializeLater()}},initializeLater:function(){this.listenTo(this.models.history,"change",function(){this.models.yesterday.fetch()});this.listenTo(this.models.yesterday,"change",this.render);this.models.history.fetch()},render:function(){if(!this.models.history||!this.models.yesterday){return}var b={weather:this.models.weather.attributes,history:this.models.history.attributes,yesterday:this.models.yesterday.attributes,airport:wui.bootstrapped.citypage.airports[0].code};this.template=_.template(a("script#almanac-history-template").html());var c=this.template(b);this.$el.html(c);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.Almanac=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.models=this.options.models||{}},initializeLater:function(){this.createViews();this.models.weather.fetchMore({features:["extremes"]})},createViews:function(){this.views={};if(a("#almanac-history")[0]){this.views.almanacHistoryView=new wui.citypage.Views.AlmanacHistory({el:a("#almanac-history")[0],model:this.model,models:{weather:this.models.weather,history:this.models.history,yesterday:this.models.yesterday},render:true})}if(a("#extremes-mod")[0]&&wui.asyncCityPage){this.views.extremesView=new wui.citypage.Views.Extremes({el:a("#extremes-mod")[0],models:{weather:this.models.weather}})}if(a("#astronomy-mod")[0]&&wui.asyncCityPage){this.views.astronomyView=new wui.citypage.Views.Astronomy({el:a("#astronomy-mod")[0],model:this.model,models:{weather:this.models.weather},render:true})}}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.Astronomy=Backbone.View.extend({initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.model=this.options.model||{};this.listenTo(this.models.weather,"change:astronomy10day",this.updateVariables);if(this.options.render){this.initializeLater()}},initializeLater:function(){this.render()},getVariableElement:function(c){var e=this.model.get("classNames");var d=this.$el.find("."+e.wxdata+"[data-variable]");if(c){d=d.filter('[data-variable="'+c+'"]')}return d},render:function(){this.updateVariables();this.updateMoonPhases();return this},timeString:function(c){c.hour%=12;if(c.hour===0){c.hour=12}return c.hour+":"+c.min+" "+c.ampm+" "+c.tz_short},updateMoonPhases:function(){var g=this.models.weather.attributes.response.location;var d=this.models.weather.attributes.astronomy.days[0];var f=this.models.weather.attributes.astronomy.moon_phases;var i=this.models.weather.attributes.labels;var h=this.model.get("localtime");this.$moonPhaseBox=this.$el.find("#moonPhases");var c={labels:i,today:d,moonDays:f,localtime:h,loc:g};this.template=_.template(b("script#moon-phase-template").html());var e=this.template(c);this.$moonPhaseBox.html(e)},updateVariables:function(){var g=this.models.weather.attributes.labels;var f=this.model.get("localtime");var e=this.model.get("usertime");var d=this.models.weather.attributes.astronomy.days[0];if(!d){return}var c=this;_.each(d,function(j,o){var h=c.getVariableElement(o);var n=h[0];if(h[0]){if(o=="moonrise"||o=="moonset"){var p=c.timeString(j.date);if(e.day!=j.date.day){p=p+" ("+j.date.month+"/"+j.date.day+")"}if(j.date.epoch==0){if(o=="moonrise"){p=g.nomoonrise.label}else{if(o=="moonset"){p=g.nomoonset.label}}}h.html(p)}else{if(j.date){var p=c.timeString(j.date);if(j.date.epoch==0){p=j.english_phrase}h.html(p)}else{if(o=="length_of_day_diff_nextday"){var i=j.minutes,l=j.seconds,k=j.sign;var m=(k=="-")?"shorter":"longer";var p=i+"m"+l+"s "+m;a.updateVariable(h,o,p,{})}else{h.html(j)}}}}})}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.BlogsNews=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.listenTo(this.models.weather,"change",this.render)},render:function(){var f=this.models.weather;if(!f.changed.blogs||!f.changed.news){return}var e=f.get("blogs");var d=f.get("news");if(!e||!d){return}var b={blogs:e,news:d};this.template=_.template(a("script#blogs-news-template").html());var c=this.template(b);this.$el.html(c);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.Community=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.models=this.options.models||{}},initializeLater:function(){this.createViews();this.models.weather.fetchMore({features:["blogs","news","editorspick"]})},createViews:function(){this.views={};if(a("#blogs-news")[0]){this.views.blogsNewsView=new wui.citypage.Views.BlogsNews({el:a("#blogs-news")[0],models:{weather:this.models.weather}})}if(a("#photo-mod")[0]){this.views.editorsPickView=new wui.citypage.Views.EditorsPick({el:a("#photo-mod")[0],models:{weather:this.models.weather}})}if(a("#video-mod")[0]){this.views.videosView=new wui.Views.Videos({el:a("#video-mod")[0],render:true,videos:wui.bootstrapped.videos})}}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.Earthquakes=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$tbody=this.$el.find("#earthquake-table").children("tbody").eq(0);this.listenTo(this.models.weather,"change:earthquakes",this.render)},render:function(){var d=this.models.weather;var b={labels:d.attributes.labels,weather:d.attributes};this.template=_.template(a("script#earthquake-template").html());var c=this.template(b);this.$tbody.html(c);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.EditorsPick=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.views={};this.listenTo(this.models.weather,"change:editorspick",this.render)},render:function(){var b=this.models.weather.get("editorspick");if(this.views.photoSlideshowView){this.views.photoSlideshowView.options.photos=b}else{this.views.photoSlideshowView=new wui.Views.PhotoSlideshow({el:this.el,photos:b,render:true})}return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.Extremes=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$tbody=this.$el.find("#extremes-table").children("tbody").eq(0);this.$title=this.$el.find("#extremes-title");this.listenTo(this.models.weather,"change:extremes",this.render)},render:function(){var e=this.models.weather;var b={labels:e.attributes.labels,weather:e.attributes};this.template=_.template(a("script#extremes-template").html());var c=this.template(b);this.$tbody.html(c);var d=e.get("extremes.title");this.$title.html(d);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.Nearby=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.models=this.options.models||{}},initializeLater:function(){this.createViews();this.models.weather.fetchMore({features:["labels","health","snowdepth","watertemps","earthquakes"]})},createViews:function(){this.views={};if(a("#aq-mod")[0]&&wui.asyncCityPage){this.views.airQualityView=new wui.citypage.Views.AirQuality({el:a("#aq-mod")[0],models:{weather:this.models.weather}})}if(a("#snow-mod")[0]&&wui.asyncCityPage){this.views.snowDepthView=new wui.citypage.Views.SnowDepth({el:a("#snow-mod")[0],models:{weather:this.models.weather}})}if(a("#water-mod")[0]&&wui.asyncCityPage){this.views.waterTempsView=new wui.citypage.Views.WaterTemps({el:a("#water-mod")[0],models:{weather:this.models.weather}})}if(a("#earthquake-mod")[0]&&wui.asyncCityPage){this.views.earthquakesView=new wui.citypage.Views.Earthquakes({el:a("#earthquake-mod")[0],models:{weather:this.models.weather}})}}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.SnowDepth=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$tbody=this.$el.find("#snow-table").children("tbody").eq(0);this.$link=this.$el.find("#snow-link");this.listenTo(this.models.weather,"change:snowdepth",this.render)},render:function(){var e=this.models.weather;var b={labels:e.attributes.labels,weather:e.attributes};this.template=_.template(a("script#snow-template").html());var c=this.template(b);this.$tbody.html(c);var d=e.get("snowdepth.link");this.$link.attr("href",d);return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.StationList=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.weather=this.options.weather;this.collections=this.options.collections},initializeLater:function(){var c=this.model.get("classNames");this.$el.addClass(c.loading);this.listenTo(this.weather,"currentStationChange",this.onChangeStationId);var b=this;b.initializeStations()},initializeStations:function(){if(this.collections.nearbyStations.numFetches==0){this.listenToOnce(this.collections.nearbyStations,"sync",this.onStationsChanged);this.collections.nearbyStations.fetchDefaultStations({initialStations:true,selectedStation:this.weather.get("current_observation.station")})}else{this.renderStations()}},onChangeStationId:function(){this.renderStations()},onStationsChanged:function(d,b,c){this.renderStations()},renderStations:function(){var e=this.collections.nearbyStations.defaultStations.slice(0,30);var b={wx:this.weather,weather:this.weather.attributes,labels:this.weather.attributes.labels,nearbyStations:e};this.template=_.template(a("script#station-list-template").html());var c=this.template(b);this.$el.html(c);var d=this.model.get("classNames");this.$el.removeClass(d.loading);a("#station-list-table").table().data("table").refresh();return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.WaterTemps=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$tbody=this.$el.find("#water-table").children("tbody").eq(0);this.$link=this.$el.find("#water-link");this.listenTo(this.models.weather,"change:watertemps",this.render)},render:function(){var e=this.models.weather;var b={labels:e.attributes.labels,weather:e.attributes};this.template=_.template(a("script#water-template").html());var c=this.template(b);this.$tbody.html(c);var d=e.get("watertemps.link");this.$link.attr("href",d);return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.Webcams=Backbone.View.extend({initialize:function(c){this.options=c||{};this.modal=null;this.weather=this.options.weather;this.options.selectedCam=0;this.options.pageTracker=0;this.options.INITIAL_THUMBNAILS=10;this.previewTemplate=_.template(b("#preview-template").html());this.thumbTemplate=_.template(b("#thumbnail-template").html());this.sizeTemplate=_.template(b("#camsize-template").html());this.locTemplate=_.template(b("#loc-template").html());this.pageTemplate=_.template(b("#page-template").html());this.listenTo(this.weather,"change:webcams",this.onWebcamsChange);this.render()},onWebcamsChange:function(){var c=this.weather.get("webcams");this.initPreview(0);this.setThumbNails(0);this.initSize(c);this.initLoc(0)},initPreview:function(e){var c=this.weather.get("webcams");var d=c[e].CURRENTIMAGEURL;this.$el.find(".webcams-preview").html('<img src="'+d+'">')},initLoc:function(e){var c=this.weather.get("webcams");var d=c[e].neighborhood;this.$el.find(".webcams-location").html(d)},setThumbNails:function(h){var c=this.weather.get("webcams");var g=_.size(c);var e=Math.floor(g/this.options.INITIAL_THUMBNAILS);this.options.firstCam=h;var d=this.weather.get("webcams").slice(h,h+this.options.INITIAL_THUMBNAILS);var f=this.thumbTemplate({webcams:d});this.$el.find(".webcams-thumbnails").html(f);if(this.options.pageTracker==0){this.$el.find(".webcams-page label").html("<span id='next'>next ></span>")}else{if(this.options.pageTracker==(e)){this.$el.find(".webcams-page label").html("<span id='prev'>< previous</span>")}else{this.$el.find(".webcams-page label").html("<span id='prev'>< previous</span> | <span id='next'>next ></span>")}}},initSize:function(c){this.$el.find(".webcams-size label").html("Total Webcams: "+_.size(c)+"")},updatePreview:function(d){var c=d.target.id-1;this.options.selectedCam=c;if(c%this.options.INITIAL_THUMBNAILS==0){this.setThumbNails(c)}else{this.initPreview(c);this.initLoc(c)}},getPrevThumbNailSet:function(){this.options.pageTracker--;this.options.selectedCam-=this.options.INITIAL_THUMBNAILS;if(this.options.selectedCam<0){this.options.selectedCam=0}this.setThumbNails(this.options.selectedCam)},getNextThumbNailSet:function(){this.options.pageTracker++;this.options.selectedCam+=this.options.INITIAL_THUMBNAILS;this.setThumbNails(this.options.selectedCam)},previewAdvance:function(f){this.options.selectedCam++;var c=this.weather.get("webcams");var d=_.size(c);b("#numCams").text(this.options.selectedCam+1+" of "+d);if(this.options.selectedCam<(d-1)){this.initPreview(this.options.selectedCam);this.initLoc(this.options.selectedCam);if(this.options.selectedCam>=this.options.firstCam+this.options.INITIAL_THUMBNAILS){this.setThumbNails(this.options.selectedCam)}}},swipeMe:function(){console.log("i am swiped")},events:{"click .smImage":"updatePreview","click .preview":"previewAdvance","click #next":"getNextThumbNailSet","click #prev":"getPrevThumbNailSet","swipe .preview":"swipeMe"},render:function(){this.onWebcamsChange()}})})(jQuery);(function(a){if(!window.Backbone){return}wui.citypage.Views.FeedbackForm=Backbone.View.extend({initialize:function(b){this.options=b||{}},events:{"submit form":"submit_form"},submit_form:function(c){var b=this.$el.find(".feedback-form-thank-you");this.$el.find(".feedback-form").slideUp(function(){b.show()});return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.Precip=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.versions={map:{template:"precip-map",appendTo:"#map-enticements"},inline:{template:"precip-inline",appendTo:"#precip-inline"},above:{template:"precip-abovebelow",appendTo:"#precip-above"},below:{template:"precip-abovebelow",appendTo:"#precip-below"},link:{setup:function(d){if(d.eventType!=="noprecip"){b(".precip-link").addClass("precip-present")}}}};this.weather=this.options.weather;this.listenTo(this.model,"change:statement",this.checkReady);this.listenTo(this.weather,"change:forecast",this.checkReady);this.checkReady()},checkReady:function(){if(this.model.get("statement")&&this.weather.get("response")){this.renderVersions()}},renderVersions:function(){var f=this.options.active;var g=this.weather.get("response").location;var d=this.model.get("eventType")!=="noprecip";if(d){for(var e=0,c=f.length;e<c;e++){this.render(this.versions[f[e]])}}},render:function(d){var e=this.weather.get("response");var h=this.weather.get("current_observation");var c={statement:this.model.get("statement"),eventType:this.model.get("eventType"),link:"precip-link"};c.station=h.station?h.station.id:"";var f=wui.bootstrapped&&wui.bootstrapped.precip?wui.bootstrapped.precip.baseUrl:"";if(f&&e.location){f+=a.generateCityQuery({zip:e.location.zip,magic:e.location.magic,wmo:e.location.wmo,country:e.location.country_iso3166})}c.cityUrl=f;if(d.setup){d.setup(c)}else{this.template=_.template(b("script#"+d.template).html());var g=this.template(c);b(d.appendTo).html(g).show()}return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.Pollen=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.weather=this.options.weather;this.listenTo(this.model,"change:success",this.checkReady);this.checkReady()},checkReady:function(){var c=this.model.get("highestLevel");var d="";if(this.model.get("success")&&c>=3){if(c===3){d="Alert"}else{d="Warning"}this.model.set("statement","Allergy "+d);this.render()}else{if(this.model.get("success")){this.render(true)}}},render:function(l){var f=this.weather.get("response");var j=this.weather.get("current_observation");var d=this.model.get("highestLevel");var h={statement:this.model.get("statement"),pollenType:this.model.get("pollenType"),cssClass:"",link:"pollen-link"};var c=wui.bootstrapped&&wui.bootstrapped.precip?wui.bootstrapped.precip.baseUrl:"";if(c&&f.location){c+=a.generateCityQuery({zip:f.location.zip,magic:f.location.magic,wmo:f.location.wmo,country:f.location.country_iso3166})}h.cityUrl=c;this.template=_.template(b("script#pollen-hook-template").html());this.templateExtra=_.template(b("script#pollen-hook-template").html());var g=this.template(h);var e=["low","low-medium","medium","medium-high","high","no-data"];var k=[": Low",": Low Medium",": Moderate",": High",": Very High","Information"];d=!d&&d!==0?5:d;h.cssClass=e[d];h.statement="Pollen"+k[d];h.link="pollen-new-"+e[d];var i=this.template(h);if(l){b("#pollen-hook-extra").html(i).show()}else{b("#pollen-hook").html(g).show();b("#pollen-hook-extra").html(i).show()}return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.UV=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.weather=this.options.weather;this.listenTo(this.model,"change:success",this.checkReady);this.checkReady()},checkReady:function(){if(this.model.get("success")){var e=this.model.get("forecasts");if(e&&e.length){var c=e[0].day;if(c){var d=e[0].day.uv_index;if(d>=7){this.render()}}}}},render:function(){var d=this.weather.get("response");var g=this.weather.get("current_observation");var c={};var e=wui.bootstrapped&&wui.bootstrapped.precip?wui.bootstrapped.precip.baseUrl:"";if(e&&d.location){e+=a.generateCityQuery({zip:d.location.zip,magic:d.location.magic,wmo:d.location.wmo,country:d.location.country_iso3166})}c.cityUrl=e;this.template=_.template(b("script#uv-hook-template").html());var f=this.template(c);b("#uv-hook").html(f).show();return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.AirQualityHook=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.weather=this.options.weather;this.listenTo(this.weather,"change:success",this.checkReady);this.checkReady()},checkReady:function(){if(this.weather.get("response")){this.weather.fetchMore({features:["labels","health"]});this.listenTo(this.weather,"change:health_data",this.render)}},render:function(){var f=this.weather.get("response");var j=this.weather.get("current_observation");var h={cssClass:"good",ratingLabel:""};var k=this.weather.get("health_data");var d=["low","low-medium","medium","medium-high","high","low"];var e=[": Good",": Moderate",": Unhealthy",": Unhealthy",": Very Unhealthy",""];if(k&&k.air_quality&&k.air_quality.forecast){var i=k.air_quality.forecast[0].index;i=!i&&i!==0?5:i;h.cssClass=d[i];h.ratingLabel="Today's Air Quality"+e[i]}var c=wui.bootstrapped&&wui.bootstrapped.precip?wui.bootstrapped.precip.baseUrl:"";if(c&&f.location){c+=a.generateCityQuery({zip:f.location.zip,magic:f.location.magic,wmo:f.location.wmo,country:f.location.country_iso3166})}h.cityUrl=c;this.template=_.template(b("script#air-quality-hook-template").html());var g=this.template(h);b("#air-quality-hook-extra").html(g).show();return this}})})(jQuery);(function(b){if(!window.Backbone){return}var a=wui.backbone.utils;wui.citypage.Views.Vote=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.listenTo(this.model,"change:forecast",this.checkReady);this.checkReady()},checkReady:function(){var c=this.model.get("forecast");if(this.model.get("forecast")&&wui.bootstrapped&&wui.bootstrapped.showVoteHook&&wui.bootstrapped.daysToElection){if(c&&c.days&&c.days.length>=wui.bootstrapped.daysToElection){this.render()}}},render:function(){var d=this.model.get("forecast");var f=d.days[parseInt(wui.bootstrapped.daysToElection,10)];if(f.summary.date.day!==8){for(var h=0,c=d.days.length;h<c;h++){if(d.days[h].summary.date.day===8){f=d.days[h]}}}var e={condition:f.summary.condition};this.template=_.template(b("script#vote-hook-template").html());var g=this.template(e);b("#vote-hook").html(g).show();return this}})})(jQuery);